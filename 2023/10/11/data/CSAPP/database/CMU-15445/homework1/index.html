<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon.ico">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/blog/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="homework1">
<meta property="og:url" content="http://example.com/2023/10/11/data/CSAPP/database/CMU-15445/homework1/index.html">
<meta property="og:site_name" content="Code Blog">
<meta property="og:locale">
<meta property="article:published_time" content="2023-10-11T15:54:13.000Z">
<meta property="article:modified_time" content="2023-10-11T15:54:13.000Z">
<meta property="article:author" content="Fredom Fu">
<meta property="article:tag" content="CSAPP">
<meta property="article:tag" content="database">
<meta property="article:tag" content="CMU-15445">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2023/10/11/data/CSAPP/database/CMU-15445/homework1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh'
  };
</script>

  <title>homework1 | Code Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Code Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Code Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/blog/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/ChenXinXuTUSC" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/11/data/CSAPP/database/CMU-15445/homework1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Fredom Fu">
      <meta itemprop="description" content="Code Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Code Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          homework1
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-10-11 23:54:13" itemprop="dateCreated datePublished" datetime="2023-10-11T23:54:13+08:00">2023-10-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
                </span>
            </span>

          
            <div class="post-description"> </div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="overview">OVERVIEW</h1>
<p>The first homework is to construct a set of SQL queries for analysing
a dataset that will be provided to you. For this, you will look into <a
target="_blank" rel="noopener" href="https://www.imdb.com/interfaces/">IMDB data</a>. This homework is
an opportunity to: (1) learn basic and certain advanced SQL features,
and (2) get familiar with using a full-featured DBMS, <a
target="_blank" rel="noopener" href="https://www.sqlite.org/">SQLite</a>, that can be useful for you in
the future.</p>
<h1 id="specification">SPECIFICATION</h1>
<p>The homework contains 10 questions in total and is graded out of 100
points. For each question, you will need to construct a SQL query that
fetches the desired data from the SQLite DBMS. It will likely take you
approximately 6-8 hours to complete the questions.</p>
<h2 id="placeholder-folder">Placeholder Folder</h2>
<p>Create the placeholder submission folder with the empty SQL files
that you will use for each question:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir placeholder</span><br><span class="line">$ cd placeholder</span><br><span class="line">$ touch \</span><br><span class="line">  q1_sample.sql \</span><br><span class="line">  q2_not_the_same_title.sql \</span><br><span class="line">  q3_longest_running_tv.sql \</span><br><span class="line">  q4_directors_in_each_decade.sql \</span><br><span class="line">  q5_german_type_ratings.sql \</span><br><span class="line">  q6_who_played_a_batman.sql \</span><br><span class="line">  q7_born_with_prestige.sql \</span><br><span class="line">  q8_directing_rose.sql \</span><br><span class="line">  q9_ode_to_death.sql \</span><br><span class="line">  q10_all_played_by_leo.sql</span><br><span class="line">$ cd ..</span><br></pre></td></tr></table></figure>
<p>After filling in the queries, you can compress the folder by running
the following command:</p>
<p>$ zip -j submission.zip placeholder/*.sql</p>
<p>The <code>-j</code> flag lets you compress all the SQL queries in the
zip file without path information. The grading scripts
will <strong>not</strong> work correctly unless you do this.</p>
<h1 id="instructions">INSTRUCTIONS</h1>
<h2 id="setting-up-sqlite">Setting Up SQLite</h2>
<p>You will first need to install SQLite on your development
machine.</p>
<blockquote>
<p>Make sure that you are using at least SQLite version 3.25! Older
releases (prior to 2019) will <strong>not</strong> support the SQL
features that you need to complete this assignment.</p>
</blockquote>
<h3 id="install-sqlite3-on-ubuntu-linux">Install SQLite3 on Ubuntu
Linux</h3>
<p>Please follow the <a
target="_blank" rel="noopener" href="https://www.tutorialspoint.com/sqlite/sqlite_installation.htm">instructions</a>.</p>
<h3 id="install-sqlite3-on-mac-os-x">Install SQLite3 on Mac OS X</h3>
<p>On Mac OS Leopard or later, you don't have to! It comes
pre-installed. You can upgrade it, if you absolutely need to, with <a
target="_blank" rel="noopener" href="https://15445.courses.cs.cmu.edu/spring2023/homework1/brew.sh">Homebrew</a>.</p>
<h2 id="load-the-database-dump">Load the Database Dump</h2>
<ol type="1">
<li><p>Check if <code>sqlite3</code> is properly working by <a
target="_blank" rel="noopener" href="https://sqlite.org/cli.html#getting_started">following this
tutorial</a>.</p></li>
<li><p>Download the <a
target="_blank" rel="noopener" href="https://15445.courses.cs.cmu.edu/spring2023/files/imdb-cmudb2022.db.gz">database
dump file</a>:<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget [https://15445.courses.cs.cmu.edu/fall2022/files/imdb-cmudb2022.db.gz](https://15445.courses.cs.cmu.edu/spring2023/files/imdb-cmudb2022.db.gz)</span><br></pre></td></tr></table></figure> Check its MD5 checksum to ensure that you have correctly
downloaded the file:<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ md5sum imdb-cmudb2022.db.gz</span><br><span class="line">d7cdf34f4ba029597c3774fc96bc3519  imdb-cmudb2022.db.gz</span><br></pre></td></tr></table></figure></p></li>
<li><p>Unzip the database from the provided database dump by running the
following commands on your shell. Note that the database file
be <strong>836MB</strong> after you decompress it.<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gunzip imdb-cmudb2022.db.gz</span><br><span class="line">$ sqlite3 imdb-cmudb2022.db</span><br></pre></td></tr></table></figure></p></li>
<li><p>We have prepared a random sample of the original dataset for this
assignment. Although this is not required to complete the assignment,
the complete dataset is available by following the steps <a
target="_blank" rel="noopener" href="https://pypi.org/project/imdb-sqlite/">here</a>.</p></li>
<li><p>Check the contents of the database by running
the <code>.tables</code> command on the <code>sqlite3</code> terminal.
You should see <strong>6 tables</strong>, and the output should look
like this:</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sqlite3 imdb-cmudb2022.db</span><br><span class="line">SQLite version 3.31.1</span><br><span class="line">Enter &quot;.help&quot; for usage hints.</span><br><span class="line">sqlite&gt; .tables</span><br><span class="line">akas      crew      episodes  people    ratings   titles</span><br></pre></td></tr></table></figure></p></li>
<li><p>Create indices using the following commands in SQLite:<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX ix_people_name ON people (name);</span><br><span class="line">CREATE INDEX ix_titles_type ON titles (type);</span><br><span class="line">CREATE INDEX ix_titles_primary_title ON titles (primary_title);</span><br><span class="line">CREATE INDEX ix_titles_original_title ON titles (original_title);</span><br><span class="line">CREATE INDEX ix_akas_title_id ON akas (title_id);</span><br><span class="line">CREATE INDEX ix_akas_title ON akas (title);</span><br><span class="line">CREATE INDEX ix_crew_title_id ON crew (title_id);</span><br><span class="line">CREATE INDEX ix_crew_person_id ON crew (person_id);</span><br></pre></td></tr></table></figure></p></li>
</ol>
<p>以上是作业一的一些要求和前置操作。不过为了不污染主机系统，所以将sqlite3安装在docker中，并通过挂载主机的目录到docker容器内完成实验作业。</p>
<p>那么首先就要安装docker，配置好docker，参考笔记<a
href="obsidian://open?vault=testrepo&amp;file=linux%2Fdocker%2F%E4%BD%BF%E7%94%A8Clash%E4%BD%9C%E4%B8%BAdocker%20daemon%E7%9A%84%E4%BB%A3%E7%90%86">使用Clash作为docker
daemon代理</a>，完成docker配置后，可以写docker
file，使用最小的Linux发行版<strong>Alpine</strong>,
安装sqlite并在容器内做实验：<br />
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> alpine:latest</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk update &amp;&amp; apk add sqlite</span></span><br></pre></td></tr></table></figure> 使用以下脚本启动容器并进入容器内启动sqlite：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">docker container prune -f</span><br><span class="line">docker run -it -v /home/fredom/workspace/CMU-15445/data:/data alpine-sqlite3 sh -c &quot;cd data &amp;&amp; sqlite3 imdb-cmudb2022.db&quot;</span><br></pre></td></tr></table></figure></p>
<p>记得执行上述作业前置步骤中的第6步，为数据库中的表创建好索引。</p>
<h2 id="check-the-schema">Check the schema</h2>
<p>Get familiar with the schema (structure) of the tables (what
attributes do they contain, what are the primary and foreign keys). Run
the <code>.schema $TABLE_NAME</code> command on
the <code>sqlite3</code> terminal for each table. The output should look
like the example below for each table.</p>
<h3 id="people">PEOPLE</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .schema people</span><br><span class="line">CREATE TABLE people (</span><br><span class="line">  person_id VARCHAR PRIMARY KEY,</span><br><span class="line">  name VARCHAR,</span><br><span class="line">  born INTEGER,</span><br><span class="line">  died INTEGER</span><br><span class="line">);</span><br><span class="line">CREATE INDEX ix_people_name ON people (name);</span><br></pre></td></tr></table></figure>
<p>Contains details for a person. For example, this is a row from the
table:</p>
<p>nm0000006|Ingrid Bergman|1915|1982</p>
<p>To breakdown the row, the field <code>person_id</code> corresponds to
"nm0000006", <code>name</code> corresponds to "Ingrid
Bergman", <code>born</code> corresponds to "1981",
and <code>died</code> corresponds to "1982".</p>
<p>sqlite默认的输出格式很简单，如果想要类似MySQL那样的表格格式化输出，可以使用命令<code>.mode column</code>，以列的形式输出。<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from people limit 10;</span><br><span class="line">nm0000004|John Belushi|1949|1982</span><br><span class="line">nm0000005|Ingmar Bergman|1918|2007</span><br><span class="line">nm0000006|Ingrid Bergman|1915|1982</span><br><span class="line">nm0000011|Gary Cooper|1901|1961</span><br><span class="line">nm0000018|Kirk Douglas|1916|2020</span><br><span class="line">nm0000022|Clark Gable|1901|1960</span><br><span class="line">nm0000023|Judy Garland|1922|1969</span><br><span class="line">nm0000035|James Horner|1953|2015</span><br><span class="line">nm0000037|Gene Kelly|1912|1996</span><br><span class="line">nm0000039|Deborah Kerr|1921|2007</span><br></pre></td></tr></table></figure> 使用<code>.mode column</code>改变输出格式后：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .mode column</span><br><span class="line">sqlite&gt; select * from people limit 10;</span><br><span class="line">person_id  name            born  died</span><br><span class="line">---------  --------------  ----  ----</span><br><span class="line">nm0000004  John Belushi    1949  1982</span><br><span class="line">nm0000005  Ingmar Bergman  1918  2007</span><br><span class="line">nm0000006  Ingrid Bergman  1915  1982</span><br><span class="line">nm0000011  Gary Cooper     1901  1961</span><br><span class="line">nm0000018  Kirk Douglas    1916  2020</span><br><span class="line">nm0000022  Clark Gable     1901  1960</span><br><span class="line">nm0000023  Judy Garland    1922  1969</span><br><span class="line">nm0000035  James Horner    1953  2015</span><br><span class="line">nm0000037  Gene Kelly      1912  1996</span><br><span class="line">nm0000039  Deborah Kerr    1921  2007</span><br></pre></td></tr></table></figure></p>
<p>本作业中并未使用到数据库的所有表，使用到的表ER图如下：<br />
<img
src="https://15445.courses.cs.cmu.edu/spring2023/files/schema2022.png"
alt="ER graph" /></p>
<h2 id="construct-the-sql-queries">Construct the SQL Queries</h2>
<p>Now, it's time to start constructing the SQL queries and put them
into the placeholder files.</p>
<h3 id="q1-0-points-q1_sample">Q1 [0 points] (q1_sample):</h3>
<p>The purpose of this query is to make sure that the formatting of your
output matches exactly the formatting of our auto-grading script.</p>
<p><strong>Details:</strong> List the first ten roles of the cast crew
members ordered alphabetically.</p>
<p><strong>Answer</strong>: Here's the correct SQL query and expected
output:<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT DISTINCT(category)</span><br><span class="line">   ...&gt; FROM crew</span><br><span class="line">   ...&gt; ORDER BY category</span><br><span class="line">   ...&gt; LIMIT 10;</span><br><span class="line">actor</span><br><span class="line">actress</span><br><span class="line">archive_footage</span><br><span class="line">archive_sound</span><br><span class="line">cinematographer</span><br><span class="line">composer</span><br><span class="line">director</span><br><span class="line">editor</span><br><span class="line">producer</span><br><span class="line">production_designer</span><br></pre></td></tr></table></figure></p>
<h3 id="q2-5-points-q2_not_the_same_title">Q2 [5 points]
(q2_not_the_same_title):</h3>
<p>Find the 10 Action movies with the newest premiere date whose
original title is not the same as its primary title.</p>
<p><strong>Details:</strong> Print the premiere year, followed by the
two titles in a special format. The column listing the two titles should
be in the format of <code>primary_title (original_title)</code> Note a
work is <code>Action</code> even if it is categorized in multiple
genres, as long as <code>Action</code> is one of the genres. Also note
that it's possible for the premiered year to be in the future. If
multiple movies premiered in the same year, order them alphabetically.
Your first row should look like
this: <code>2027|The Adventures of Tintin: Red Rackham's Treasure (Untitled Adventures of Tintin Sequel)</code><br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	premiered,</span><br><span class="line">	primary_title <span class="operator">||</span> <span class="string">&#x27;(&#x27;</span> <span class="operator">||</span> original_title <span class="operator">||</span> <span class="string">&#x27;)&#x27;</span> <span class="keyword">AS</span> title</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	titles</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	original_title <span class="operator">!=</span> primary_title <span class="keyword">AND</span></span><br><span class="line">	genres <span class="keyword">LIKE</span> <span class="string">&#x27;%Action%&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">	premiered <span class="keyword">DESC</span></span><br><span class="line">LIMIT</span><br><span class="line">	<span class="number">10</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure> 本题考查的点主要是字符串的拼接，即对拼接运算符
<strong>||</strong> 的使用，其他地方没有特别的难点。</p>
<h3 id="q3-5-points-q3_longest_running_tv">Q3 [5 points]
(q3_longest_running_tv):</h3>
<p>Find the top 20 longest running tv series.</p>
<p><strong>Details:</strong> Print the title and the years the series
has been running for. The series must have a
non <code>NULL</code> premiered year. If the ended date
is <code>NULL</code>, assume it to be the current year (2023). If
multiple tv series have been running the same number of years, order
them alphabetically. Print the top 20 results.<br />
Your output should have the
format: <code>TITLE|YEARS_RUNNING</code><br />
Your first row should look like this: <code>Looney Tunes|93</code><br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	primary_title <span class="keyword">AS</span> title, (IFNULL(ended, <span class="number">2023</span>) <span class="operator">-</span> premiered) <span class="keyword">AS</span> years_running</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	titles</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	premiered <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> type <span class="operator">=</span> <span class="string">&#x27;tvSeries&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">	years_running <span class="keyword">DESC</span>,</span><br><span class="line">	title <span class="keyword">ASC</span></span><br><span class="line">LIMIT</span><br><span class="line">	<span class="number">20</span></span><br><span class="line">; </span><br></pre></td></tr></table></figure>
本题考察的点是对NULL值的处理，除了IFNULL函数对遇到记录的属性为NULL值的替换，还有CASE语句可以使用，但是我没有去查CASE的使用方法，而是用了IFNULL。</p>
<h3 id="q4-10-points-q4_directors_in_each_decade">Q4 [10 points]
(q4_directors_in_each_decade):</h3>
<p>List the number directors born in each decade since 1900.</p>
<p><strong>Details:</strong> Print the decade in a fancier format by
constructing a string that looks like this: <code>1990s</code>. Order
the results by decade.<br />
Your output should look like
this: <code>DECADE|NUM_DIRECTORS</code><br />
Your first row should look like this: <code>1900s|376</code><br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="built_in">CAST</span>(born <span class="operator">/</span> <span class="number">10</span> <span class="operator">*</span> <span class="number">10</span> <span class="keyword">AS</span> TEXT) <span class="operator">||</span> <span class="string">&#x27;s&#x27;</span> <span class="keyword">AS</span> decade, <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span>(p.person_id)) <span class="keyword">AS</span> num_directors</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	people <span class="keyword">AS</span> p <span class="keyword">INNER</span> <span class="keyword">JOIN</span> crew <span class="keyword">AS</span> c <span class="keyword">ON</span> p.person_id <span class="operator">=</span> c.person_id </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	born <span class="operator">&gt;=</span> <span class="number">1900</span> <span class="keyword">AND</span> category <span class="operator">=</span> <span class="string">&#x27;director&#x27;</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> (</span><br><span class="line">	decade</span><br><span class="line">)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
本题考察的点在于通过<code>INNER JOIN</code>来结合两张表的信息一起使用，并且了解计算机的整数除法会舍去小数部分的特点。考察了转换函数，因为标题要求显示年代+'s'，这就必须把数值类型转换为字符串类型才能继续字符串拼接操作。</p>
<h3 id="q5-10-points-q5_german_type_ratings">Q5 [10 points]
(q5_german_type_ratings):</h3>
<p>Compute statistics about different type of works that has a German
title.</p>
<p><strong>Details:</strong> Compute the average (rounded to 2 decimal
places), min, and max rating for each type of work that has a German
title and the akas types is
either <code>imdbDisplay</code> or <code>original</code>. Sort the
output by the average rating of each title type.<br />
Your output should have the
format: <code>TITLE_TYPE|AVG_RATING|MIN_RATING|MAX_RATING</code><br />
Your first row should look like
this: <code>movie|6.65|3.4|8.2</code><br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	titles.type <span class="keyword">AS</span> title_type,</span><br><span class="line">	ROUND(<span class="built_in">AVG</span>(rating), <span class="number">2</span>) <span class="keyword">AS</span> avg_rating,</span><br><span class="line">	<span class="built_in">MIN</span>(rating) <span class="keyword">AS</span> min_rating,</span><br><span class="line">	<span class="built_in">MAX</span>(rating) <span class="keyword">AS</span> max_rating</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	(titles <span class="keyword">INNER</span> <span class="keyword">JOIN</span> akas <span class="keyword">ON</span> titles.title_id <span class="operator">=</span> akas.title_id) <span class="keyword">INNER</span> <span class="keyword">JOIN</span> ratings <span class="keyword">ON</span> titles.title_id <span class="operator">=</span> ratings.title_id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	akas.language <span class="operator">=</span> <span class="string">&#x27;de&#x27;</span> <span class="keyword">AND</span> (akas.types <span class="operator">=</span> <span class="string">&#x27;imdbDisplay&#x27;</span> <span class="keyword">OR</span> akas.types <span class="operator">=</span> <span class="string">&#x27;original&#x27;</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> (</span><br><span class="line">	titles.type</span><br><span class="line">)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_rating</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
题目中说要求统计德语标题的作品的平均分、最大分、最小分。可是当然不能直接判断标题是否含有德文，一个直接的方法是使用其他表的<code>language</code>信息来做筛选条件，德语的缩写是<strong>de</strong>。</p>
<h3 id="q6-10-points-q6_who_played_a_batman">Q6 [10 points]
(q6_who_played_a_batman):</h3>
<p>List the 10 highest rated actors who played a character named
"Batman".</p>
<p><strong>Details:</strong> Calculate the actor rating by taking the
average rating of all their works. Return both the name of the actor and
their rating and only list the top 10 results in order from highest to
lowest rating. Round average rating to the nearest hundredth.<br />
Make sure your output is formatted as
follows: <code>Kayd Currier|8.05</code><br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	name, FORMAT(&quot;%.2f&quot;, <span class="built_in">AVG</span>(rating)) <span class="keyword">AS</span> avg_rating</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	ratings <span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line">			name,</span><br><span class="line">			title_id</span><br><span class="line">		<span class="keyword">FROM</span></span><br><span class="line">			people <span class="keyword">INNER</span> <span class="keyword">JOIN</span> crew <span class="keyword">ON</span> people.person_id <span class="operator">=</span> crew.person_id</span><br><span class="line">		<span class="keyword">WHERE</span></span><br><span class="line">			crew.person_id <span class="keyword">IN</span> (</span><br><span class="line">				<span class="keyword">SELECT</span></span><br><span class="line">					person_id</span><br><span class="line">				<span class="keyword">FROM</span></span><br><span class="line">					crew</span><br><span class="line">				<span class="keyword">WHERE</span></span><br><span class="line">					characters <span class="keyword">LIKE</span> <span class="string">&#x27;%Batman%&#x27;</span></span><br><span class="line">			)</span><br><span class="line">	) <span class="keyword">AS</span> tmp <span class="keyword">ON</span> tmp.title_id <span class="operator">=</span> ratings.title_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>(</span><br><span class="line">	name</span><br><span class="line">)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">	avg_rating <span class="keyword">DESC</span></span><br><span class="line">LIMIT</span><br><span class="line">	<span class="number">10</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>
本小题主要考察了子查询的使用。题目的大意是，找出所有曾扮演过蝙蝠侠这个角色的演员，并且找出这些演员参演过的作品，计算这些作品的平均分。然后根据平均分对这些扮演过蝙蝠侠的演员进行排序，列出平均分前十名。另外一个难题就是小数点的格式化，发现在sqlite中就算把数值类型转为<code>DECIMAL(X,Y)</code>，也不会显示Y位小数，而是始终根据有效数位显示。这里只能通过转换为字符串形式并使用字符串。</p>
<h3 id="q7-15-points-q7_born_with_prestige">Q7 [15 points]
(q7_born_with_prestige):</h3>
<p>List the number of actors or actress who were born on the year that
"The Prestige" was premiered.</p>
<p><strong>Details:</strong> Print only the total number of actors born
that year. For this question, determine distinct people by
their <code>person_id</code>, not their names. Do not hard code the
query.<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	<span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> people.person_id)</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	people <span class="keyword">INNER</span> <span class="keyword">JOIN</span> crew <span class="keyword">ON</span> people.person_id <span class="operator">=</span> crew.person_id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	born <span class="keyword">IN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span></span><br><span class="line">			premiered</span><br><span class="line">		<span class="keyword">FROM</span></span><br><span class="line">			titles</span><br><span class="line">		<span class="keyword">WHERE</span></span><br><span class="line">			primary_title <span class="operator">=</span> <span class="string">&#x27;The Prestige&#x27;</span></span><br><span class="line">	) <span class="keyword">AND</span> (</span><br><span class="line">		category <span class="operator">=</span> <span class="string">&#x27;actor&#x27;</span> <span class="keyword">OR</span> category <span class="operator">=</span> <span class="string">&#x27;actress&#x27;</span></span><br><span class="line">	)</span><br><span class="line">;</span><br></pre></td></tr></table></figure> 题目大意：统计出生年份与作品“The
Prestige”首映年份相同相同的男演员或者女演员。这题没有什么难点，主要的坑在于表<code>crew</code>中的person_id并不是唯一主键，有很多重复的，查询出来的结果记得使用<strong>DISTINCT</strong>关键字去重。</p>
<h3 id="q8-15-points-q8_directing_rose.sql">Q8 [15 points]
(q8_directing_rose.sql):</h3>
<p>Find all the directors who have worked with an actress with first
name "Rose".</p>
<p><strong>Details:</strong> Print only the names of the directors in
alphabetical order. Each name should only appear once in the
output.<br />
Your first row should look like this: <code>Aimé Forget</code><br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line">	name</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">	crew <span class="keyword">INNER</span> <span class="keyword">JOIN</span> people <span class="keyword">ON</span> crew.person_id <span class="operator">=</span> people.person_id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	crew.category <span class="operator">=</span> <span class="string">&#x27;director&#x27;</span></span><br><span class="line">	<span class="keyword">AND</span></span><br><span class="line">	crew.title_id <span class="keyword">IN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line">			crew.title_id</span><br><span class="line">		<span class="keyword">FROM</span></span><br><span class="line">			crew <span class="keyword">INNER</span> <span class="keyword">JOIN</span> people <span class="keyword">ON</span> crew.person_id <span class="operator">=</span> people.person_id</span><br><span class="line">		<span class="keyword">WHERE</span></span><br><span class="line">			crew.category <span class="operator">=</span> <span class="string">&#x27;actress&#x27;</span> <span class="keyword">AND</span> people.name <span class="keyword">LIKE</span> <span class="string">&#x27;Rose%&#x27;</span></span><br><span class="line">	)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">	name <span class="keyword">ASC</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>
题目大意：列出所有参演人员列表中有名字以Rose开头的女演员的电影的导演名字。通过子查询来找到所有这样的电影，然后选出所有工作类别为导演的人，看他们参与的作品ID是否在之前找到的作品ID集合中。</p>
<h3 id="q9-15-points-q9_ode_to_the_dead">Q9 [15 points]
(q9_ode_to_the_dead):</h3>
<p>List the longest work for the first 5 cast members sorted by year of
death for each type of role.</p>
<p><strong>Details:</strong> For each role, find the first 5 artists
sorted by year of death and print their work with the longest runtime.
The final output should be sorted alphabetically by category, then by
year of death of the artist and finally by alphabetical order of artist
name. If an artist has multiple works with the the same longest runtime,
pick the one with the smallest <code>title_id</code>. Your output should
look like
this: <code>CATEGORY|NAME|DEATH YEAR|LONGEST WORK TITLE|WORK RUNTIME|CATEGORY RANK</code> Your
first row should look like
this: <code>actor|Verner Clarges|1911|A Summer Idyll|17|1</code></p>
<p><strong>Note:</strong> Omit artists that do not have work with a
non-null runtime.<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span></span><br><span class="line">died_runt_rank <span class="keyword">AS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		category,</span><br><span class="line">		name,</span><br><span class="line">		died,</span><br><span class="line">		primary_title,</span><br><span class="line">		runtime_minutes,</span><br><span class="line">		<span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span> (</span><br><span class="line">			<span class="keyword">PARTITION</span> <span class="keyword">BY</span></span><br><span class="line">				c.category</span><br><span class="line">			<span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">				p.died <span class="keyword">ASC</span>,</span><br><span class="line">				p.name <span class="keyword">ASC</span></span><br><span class="line">		) <span class="keyword">AS</span> died_rank,</span><br><span class="line">		<span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span> (</span><br><span class="line">			<span class="keyword">PARTITION</span> <span class="keyword">BY</span></span><br><span class="line">				c.category,</span><br><span class="line">				c.person_id</span><br><span class="line">			<span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">				t.runtime_minutes <span class="keyword">DESC</span>,</span><br><span class="line">				t.title_id <span class="keyword">ASC</span></span><br><span class="line">		) <span class="keyword">AS</span> runt_rank</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		crew <span class="keyword">AS</span> c</span><br><span class="line">		<span class="keyword">INNER</span> <span class="keyword">JOIN</span> people <span class="keyword">as</span> p <span class="keyword">ON</span> c.person_id <span class="operator">=</span> p.person_id</span><br><span class="line">		<span class="keyword">INNER</span> <span class="keyword">JOIN</span> titles <span class="keyword">as</span> t <span class="keyword">ON</span> c.title_id <span class="operator">=</span> t.title_id</span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		p.died <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span></span><br><span class="line">		t.runtime_minutes <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">),</span><br><span class="line">first_five_per_category <span class="keyword">AS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		category,</span><br><span class="line">		name,</span><br><span class="line">		died,</span><br><span class="line">		primary_title,</span><br><span class="line">		runtime_minutes,</span><br><span class="line">		died_rank</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		died_runt_rank</span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		died_rank <span class="operator">&lt;=</span> <span class="number">5</span> <span class="keyword">AND</span></span><br><span class="line">		runt_rank <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	first_five_per_category</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">	category <span class="keyword">ASC</span>,</span><br><span class="line">	died_rank <span class="keyword">ASC</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>
这题的第一个难点是需要被排序的属性很多，弄清楚排序的优先级很重要，不能弄混，第一优先级是死亡年份，然后是作品时长。而且需要注意的是，排序是在每个职员类别之中排序，每个类别有自己的排序，不参与全局的排序，这里明显要求我们使用<code>GROUP BY</code>关键字进行分组。第二个难点在于如何固定每个分组的输出数量为5条记录，这里是通过使用DENSE_RANK()函数对分组内的记录进行排序标号，并只选取顺位小于等于5的记录来实现的。</p>
<h3 id="q10-15-points-q10_all_played_by_leo">Q10 [15 points]
(q10_all_played_by_leo):</h3>
<p>List all the unique characters Leonardo DiCaprio (born in 1974) ever
played as a string of comma-separated values in alphabetical order of
the character names.</p>
<p><strong>Details:</strong> Find all the unique characters played by
Leonardo DiCaprio and order them alphabetically. Exclude those
characters containing the character sequence <code>Self</code>. Print a
single string containing all these characters separated by commas.<br />
<strong>Hint:</strong> You might find <a
target="_blank" rel="noopener" href="https://sqlite.org/lang_with.html">Recursive
CTEs</a> useful.<br />
<strong>Note:</strong> Watch out for the format of
the <code>characters</code> field. An actor can play more than one
characters in a single work.<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span></span><br><span class="line">leo_played <span class="keyword">AS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line">		characters</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		people</span><br><span class="line">		<span class="keyword">INNER</span> <span class="keyword">JOIN</span> crew <span class="keyword">ON</span> people.person_id <span class="operator">=</span> crew.person_id</span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		people.name <span class="operator">=</span> <span class="string">&#x27;Leonardo DiCaprio&#x27;</span> <span class="keyword">AND</span></span><br><span class="line">		people.born <span class="operator">=</span> <span class="number">1974</span> <span class="keyword">AND</span></span><br><span class="line">		crew.characters <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%Self%&#x27;</span> <span class="keyword">AND</span></span><br><span class="line">		crew.characters <span class="operator">!=</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">		crew.characters <span class="keyword">ASC</span></span><br><span class="line">),</span><br><span class="line">json_data <span class="keyword">AS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line">		<span class="keyword">value</span> <span class="keyword">AS</span> characters,</span><br><span class="line">		<span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>() <span class="keyword">AS</span> row_num</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		leo_played,</span><br><span class="line">		JSON_EACH(leo_played.characters)</span><br><span class="line">),</span><br><span class="line">boundary_row_num <span class="keyword">AS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		<span class="built_in">MAX</span>(row_num) <span class="keyword">AS</span> max_row_num</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		json_data</span><br><span class="line">),</span><br><span class="line">recursive_build (played, idx) <span class="keyword">AS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		characters, <span class="number">1</span></span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		json_data</span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		row_num <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">UNION</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		played <span class="operator">||</span> <span class="string">&#x27;,&#x27;</span> <span class="operator">||</span> characters, idx <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> new_idx</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		recursive_build</span><br><span class="line">		<span class="keyword">INNER</span> <span class="keyword">JOIN</span> json_data <span class="keyword">ON</span> recursive_build.idx <span class="operator">+</span> <span class="number">1</span> <span class="operator">=</span> json_data.row_num</span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		json_data.row_num <span class="operator">=</span> idx <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AND</span></span><br><span class="line">		idx <span class="operator">+</span> <span class="number">1</span> <span class="operator">&lt;=</span> (</span><br><span class="line">			<span class="keyword">SELECT</span></span><br><span class="line">				max_row_num</span><br><span class="line">			<span class="keyword">FROM</span></span><br><span class="line">				boundary_row_num</span><br><span class="line">		)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	recursive_build</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	idx <span class="keyword">IN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span></span><br><span class="line">			max_row_num</span><br><span class="line">		<span class="keyword">FROM</span></span><br><span class="line">			boundary_row_num</span><br><span class="line">	)</span><br><span class="line">;</span><br></pre></td></tr></table></figure> 本题要列出Leonardo
DiCaprio曾经扮演过的角色的记录不难：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line">	characters</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	people</span><br><span class="line">	<span class="keyword">INNER</span> <span class="keyword">JOIN</span> crew <span class="keyword">ON</span> people.person_id <span class="operator">=</span> crew.person_id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	people.name <span class="operator">=</span> <span class="string">&#x27;Leonardo DiCaprio&#x27;</span> <span class="keyword">AND</span></span><br><span class="line">	people.born <span class="operator">=</span> <span class="number">1974</span> <span class="keyword">AND</span></span><br><span class="line">	crew.characters <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%Self%&#x27;</span> <span class="keyword">AND</span></span><br><span class="line">	crew.characters <span class="operator">!=</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">		crew.characters <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure>
终点是这些记录怎么拼接为单一的一行字符串，而且原先的每行记录还要拆分之后重新用逗号分隔。仔细看
<strong>characters</strong>
这个属性的值可知，都是JSON字符串数组，好在sqlite有很多内置的便捷工具函数，自然处理JSON数据的工具也不在话下。<strong>JSON_EACH(table)</strong>
函数能对给定表的每一条记录，如果是数组类型的元素的话，进行拆分，数组内的每个元素将称为返回的表的每一行记录。</p>
<p>Recursive
CTE就是允许调用自身的查询，类似于递归函数，定义递归调用的入口点，每一层递归拿取下一层递归返回上来的返回值做一些处理然后再返回给上一层，一般这个处理在SELECT中完成，在SELECT中完成处理之后再返回给上一层调用。<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">recursive_build (played, idx) <span class="keyword">AS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		characters, <span class="number">1</span></span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		json_data</span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		row_num <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">UNION</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		played <span class="operator">||</span> <span class="string">&#x27;,&#x27;</span> <span class="operator">||</span> characters, idx <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> new_idx</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		recursive_build</span><br><span class="line">		<span class="keyword">INNER</span> <span class="keyword">JOIN</span> json_data <span class="keyword">ON</span> recursive_build.idx <span class="operator">+</span> <span class="number">1</span> <span class="operator">=</span> json_data.row_num</span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		json_data.row_num <span class="operator">=</span> idx <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AND</span></span><br><span class="line">		idx <span class="operator">+</span> <span class="number">1</span> <span class="operator">&lt;=</span> (</span><br><span class="line">			<span class="keyword">SELECT</span></span><br><span class="line">				max_row_num</span><br><span class="line">			<span class="keyword">FROM</span></span><br><span class="line">				boundary_row_num</span><br><span class="line">		)</span><br><span class="line">)</span><br></pre></td></tr></table></figure> Recursive
CTE的关键是使用UNION来完成下一层的调用，一般来说，一张表在完成定义之前是不运行被引用的，但是使用了Recursive关键字的CTE是允许的，不过在sqlite中，不用显式地声明Recursive，会自动判定是否为递归调用。</p>
<p>使用额外的一张表把原先的行记录中的JSON数据转换为每个元素一行：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">json_data <span class="keyword">AS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line">		<span class="keyword">value</span> <span class="keyword">AS</span> characters,</span><br><span class="line">		<span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>() <span class="keyword">AS</span> row_num</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		leo_played,</span><br><span class="line">		JSON_EACH(leo_played.characters)</span><br><span class="line">),</span><br></pre></td></tr></table></figure></p>
<p>然后利用Recursive CTE的SELECT对这些已经处理的行数据递归地处理。</p>
<p>递归CTE的关键在于两部分，SELECT的实际处理，以及WHERE的递归结束条件，用于WHERE的限制条件类型一般是数值的操作类型，比如每次递归+1然后到哪个数就停止递归这样，如果是字符串类型的边界变量可能不太好定义WHERE边界条件</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/CSAPP/" rel="tag"># CSAPP</a>
              <a href="/blog/tags/database/" rel="tag"># database</a>
              <a href="/blog/tags/CMU-15445/" rel="tag"># CMU-15445</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2023/10/11/data/CSAPP/database/SQL/ACID/" rel="prev" title="ACID">
      <i class="fa fa-chevron-left"></i> ACID
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2023/10/11/data/CSAPP/data%20structure/Algorithm%20Tutor/web%20link/" rel="next" title="web link">
      web link <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#overview"><span class="nav-number">1.</span> <span class="nav-text">OVERVIEW</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#specification"><span class="nav-number">2.</span> <span class="nav-text">SPECIFICATION</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#placeholder-folder"><span class="nav-number">2.1.</span> <span class="nav-text">Placeholder Folder</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#instructions"><span class="nav-number">3.</span> <span class="nav-text">INSTRUCTIONS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#setting-up-sqlite"><span class="nav-number">3.1.</span> <span class="nav-text">Setting Up SQLite</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#install-sqlite3-on-ubuntu-linux"><span class="nav-number">3.1.1.</span> <span class="nav-text">Install SQLite3 on Ubuntu
Linux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#install-sqlite3-on-mac-os-x"><span class="nav-number">3.1.2.</span> <span class="nav-text">Install SQLite3 on Mac OS X</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#load-the-database-dump"><span class="nav-number">3.2.</span> <span class="nav-text">Load the Database Dump</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#check-the-schema"><span class="nav-number">3.3.</span> <span class="nav-text">Check the schema</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#people"><span class="nav-number">3.3.1.</span> <span class="nav-text">PEOPLE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#construct-the-sql-queries"><span class="nav-number">3.4.</span> <span class="nav-text">Construct the SQL Queries</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#q1-0-points-q1_sample"><span class="nav-number">3.4.1.</span> <span class="nav-text">Q1 [0 points] (q1_sample):</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q2-5-points-q2_not_the_same_title"><span class="nav-number">3.4.2.</span> <span class="nav-text">Q2 [5 points]
(q2_not_the_same_title):</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q3-5-points-q3_longest_running_tv"><span class="nav-number">3.4.3.</span> <span class="nav-text">Q3 [5 points]
(q3_longest_running_tv):</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q4-10-points-q4_directors_in_each_decade"><span class="nav-number">3.4.4.</span> <span class="nav-text">Q4 [10 points]
(q4_directors_in_each_decade):</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q5-10-points-q5_german_type_ratings"><span class="nav-number">3.4.5.</span> <span class="nav-text">Q5 [10 points]
(q5_german_type_ratings):</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q6-10-points-q6_who_played_a_batman"><span class="nav-number">3.4.6.</span> <span class="nav-text">Q6 [10 points]
(q6_who_played_a_batman):</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q7-15-points-q7_born_with_prestige"><span class="nav-number">3.4.7.</span> <span class="nav-text">Q7 [15 points]
(q7_born_with_prestige):</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q8-15-points-q8_directing_rose.sql"><span class="nav-number">3.4.8.</span> <span class="nav-text">Q8 [15 points]
(q8_directing_rose.sql):</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q9-15-points-q9_ode_to_the_dead"><span class="nav-number">3.4.9.</span> <span class="nav-text">Q9 [15 points]
(q9_ode_to_the_dead):</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q10-15-points-q10_all_played_by_leo"><span class="nav-number">3.4.10.</span> <span class="nav-text">Q10 [15 points]
(q10_all_played_by_leo):</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Fredom Fu</p>
  <div class="site-description" itemprop="description">Code Blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">315</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fredom Fu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/pjax/pjax.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/blog/js/local-search.js"></script>













    <div id="pjax">
  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '32px',
  right: '32px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>

    </div>
</body>
</html>
